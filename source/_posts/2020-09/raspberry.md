---
title: 我不推荐使用树莓派来当做家用服务器
date: 2020-9-16 03:44:41
tags: raspberry
---

> 本文，是针对想把树莓派当做家用服务器来使用的同学的一些意见。
>
> 对于物联网、家用办公等等需求的人而言，毫无意义

## 第一个树莓派

五年前，我入手了树莓派 2。

作为一代的升级版，树莓派 2 在很多方面远远超越了一代。一代树莓派，按照我朋友的描述是：基本没什么用。还不如一台十几年前的奔腾 4 电脑。据说连 SSH 到 server 端都无比的卡顿。

而树莓派 2 在硬件上有了极大的提升，至少在作为简单的脚本服务的服务器上毫不逊色，我在上面部署了多个 php 、node 服务。作为脚本语言服务器的树莓派，完全可以满足一个家用简单服务器的责任。

但是树莓派 2 有若干致命的问题：

1. usb 只有 2.0 而不支持 3.0。导致没有外接硬盘的优势不大。

2. 使用 micro usb 进行供电。供电只支持 1.5 A 左右，外接硬盘容易掉线

3. 网口是百兆

4. 内存只有 1G。

   > 当时 gitlab 应势推出了树莓派版 gitlab。
   >
   > 前期还好，后期稍有不慎就会 502。
   >
   > 最后采用加 swap 的方式缓解。但是受限于 sd 卡和 usb 2.0。使用体验十分糟糕，页面动不动就崩溃。

## 树莓派 3B & 3B+

后来又出了树莓派 3 代，但是相当二代提升极为有限，依然采用 1G 内存、USB 2.0 和百兆网卡。

而随后又出了 raspberry 3B+。架构总体和 3B 区别不大，最大的特点是升级网卡到了千兆（伪）。网卡虽然是千兆，但是走的通道是 USB 2.0。导致最后的速度只有 300M。

## 树莓派 4B

然后就是漫长的等待，等到了树莓派 4B。千兆网卡、USB 3.0、更新的 Arm 架构，甚至还有 4G 内存版本。

我也在出货第一时间订购了 4G 版本，加上注册送的优惠券。最后到手价 375。

当时我的想法是，

首先，树莓派当做一个脚本语言的服务的运行环境(例如，Python，Node， PHP，甚至是 HTML 页面)。对于这一点而言，树莓派搭建一些服务的功能的确完全足够了。

其次，想把树莓派当做一个中继 NAS。虽然我有专门的 NAS设备。但是这些设备往往都是多个硬盘，平时为了省电，也尽量作硬盘休眠。

而我日常过程中，因为没钱买高容量的 mac 电脑，两台 mini 主机，一台 128G，一台 256 G。完全不够日常使用。所以我直接把 NAS 挂载到电脑上作为扩展盘使用。

原先，我有一个迅雷下载宝。这个原价 129 的小玩意几乎可以说是神器。支持迅雷下载，又支持 SMB 协议。还可以支持刷机，直接刷出各种功能。千兆、USB 3.0。但是他本身的主控性能比较弱鸡，还有点是主控很小。导致无论怎么处理，都无法解决主控发热量大而散热面积小，导致长期处于高温的情况。

这个情况下，树莓派是我认为比较好选择。毕竟性能强了不是一点两点。

于是我转手把下载宝 60 块钱，卖了一个同事。

> 很遗憾，我的猜测完全错了



## 失败的想法

想法是美好的，但是我忘记了，虽然同为 USB 3.0 。但是树莓派 CPU 作为 arm 的产品。IO 性能的是真的弱鸡。

正常测试情况下，刚开始可以满足跑满千兆带宽 100MB。而随着文件的拷入，写入的速度越来越慢。最后保持在 80 左右。

这还是我把所有服务关闭达到的速度。假如有别的服务的干扰，速度更加不堪。

而我用 esxi 虚拟出单内核的机子，安装黑群辉，则可以轻松的保持满速。

这里有以下的几个原因：

1. 树莓派 IO 性能差
2. 树莓派系统访问硬盘也是用 USB。而 USB 的读取性能很容易被影响。
3. 我使用的硬盘是 2.5 寸的 HDD。本身的 4k 性能就比较捉急。
4. 树莓派的内存速度十分捉急



这里强调下内存速度。树莓派号称使用了 DDR4 颗粒。但是实际内存测速只有 1.3G /s。

而我在使用 DDR3 1333 的 esxi 的虚拟机里测试，都可以达到 12 G/s。而我的 mac mini 更是达到了 30G/s。

综上的情况，使我在实际使用树莓派当 nas 的时候，甚至遇到了速度低于 30 的情况。而更别说这个大文件的速度。单个小文件的速度更加龟速。加上不支持 UI 界面。对硬盘状态监测支持差，更别说 ext4 本身就是一个相对容易损坏的系统格式。不推荐树莓派作为 nas 使用。

## 其他问题

当然，除了这一点，本身还有很多问题可以吐槽的。

没有 emmc 芯片。系统默认只支持 sd 卡( raspbian 支持移动硬盘直接启动)。而通过 usb 启动系统，则要在少的可怜的 usb 接口上压榨他仅剩的带宽。



那么，对于我们而言，其实最能看到的优点就只剩下了性价比。毕竟两百多就能拥有一台小服务器。放放简单的服务还是相当不错的。

这个在国外是成立的，毕竟 35 刀的机子真的是非常的廉价。

问题是，我们这里是中国，我们有数之不尽的二手机、mini 机、工程机、甚至是矿渣。这些东西的价格都远远低于树莓派的价格。而性能又在其之上。

虽然采用的是 atom 架构的 cpu，但其本身至少是 x86 架构。性能、扩展性支持性远远高于树莓派。

更别提，还有内存的限制。

最低级的树莓派是 2G (原来是 1G)，售价 35刀 也就是 250 左右人民币。而 4G 的树莓派就要售价 55 刀，直接达到了 400 的价格。

要知道，现在一条普通的 8G  内存条，售价也仅仅是 120 左右。而便宜的 16G 内存条都已经跌倒了 200 左右。

而树莓派，多加了 2G 内存，售价就提高了差不多 60%。

同样的价格，用在工程机里，性能又好，通道又多，内存又大。何乐不为？



## 最后

强烈不推荐把树莓派当家用服务器。属于事多折腾麻烦。淘宝一大堆便宜的小型机更适合你



