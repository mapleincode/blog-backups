---
title: redis é›†ç¾¤
date: 2020-09-05 21:44:16

---



redis 3.0 å¼•å…¥çš„æ–°åŠŸèƒ½ã€‚

> ç„¶åå»çœ‹äº†ä¸‹ç°åœ¨ redis å·²ç»æ˜¯ 6.x äº†



## é€»è¾‘

æ ¹æ® `CRC16` æŠŠ key å€¼åˆ†åˆ° 16383 ä¸ªæ§½å†…ã€‚ç„¶åæŠŠè‹¥å¹²ä¸ªèŠ‚ç‚¹è®¾ç½®åˆ†åˆ«ç»´æŠ¤è‹¥å¹²ä¸ªæ§½ã€‚å®ç°èŠ‚ç‚¹åˆ†å¸ƒå¼ã€‚



## ç¼ºç‚¹

1. ä¸æ”¯æŒå¤š key å€¼æ“ä½œï¼ˆå› ä¸ºä¸åŒ key å€¼å¯èƒ½å±äºè‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼‰ã€‚
2. äº‹åŠ¡åªæ”¯æŒå• key äº‹åŠ¡
3. æ”¯æŒ 0 åº“



## é›†ç¾¤æ­å»º

> ä¸‰èŠ‚ç‚¹ä¸»ä»åº“ã€‚
>
> åªè®°å½•ï¼Œæœªæµ‹è¯•

### 0. redis.conf ç›¸å…³ cluster å‚æ•°

1. **cluster-enabled**: å¦‚æœæƒ³åœ¨ç‰¹å®šçš„Rediså®ä¾‹ä¸­å¯ç”¨Redisç¾¤é›†æ”¯æŒå°±è®¾ç½®ä¸ºyesã€‚ å¦åˆ™ï¼Œå®ä¾‹é€šå¸¸ä½œä¸ºç‹¬ç«‹å®ä¾‹å¯åŠ¨ã€‚

2. **cluster-config-file**: è¯·æ³¨æ„ï¼Œå°½ç®¡æœ‰æ­¤é€‰é¡¹çš„åç§°ï¼Œä½†è¿™ä¸æ˜¯ç”¨æˆ·å¯ç¼–è¾‘çš„é…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯Redisç¾¤é›†èŠ‚ç‚¹æ¯æ¬¡å‘ç”Ÿæ›´æ”¹æ—¶è‡ªåŠ¨ä¿ç•™ç¾¤é›†é…ç½®ï¼ˆåŸºæœ¬ä¸Šä¸ºçŠ¶æ€ï¼‰çš„æ–‡ä»¶ï¼Œä»¥ä¾¿èƒ½å¤Ÿ åœ¨å¯åŠ¨æ—¶é‡æ–°è¯»å–å®ƒã€‚ è¯¥æ–‡ä»¶åˆ—å‡ºäº†ç¾¤é›†ä¸­å…¶ä»–èŠ‚ç‚¹ï¼Œå®ƒä»¬çš„çŠ¶æ€ï¼ŒæŒä¹…å˜é‡ç­‰ç­‰ã€‚ ç”±äºæŸäº›æ¶ˆæ¯çš„æ¥æ”¶ï¼Œé€šå¸¸ä¼šå°†æ­¤æ–‡ä»¶é‡å†™å¹¶åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚

3. **cluster-node-timeout**: Redisç¾¤é›†èŠ‚ç‚¹å¯ä»¥ä¸å¯ç”¨çš„æœ€é•¿æ—¶é—´ï¼Œè€Œä¸ä¼šå°†å…¶è§†ä¸ºå¤±è´¥ã€‚ å¦‚æœä¸»èŠ‚ç‚¹è¶…è¿‡æŒ‡å®šçš„æ—¶é—´ä¸å¯è¾¾ï¼Œå®ƒå°†ç”±å…¶ä»å±è®¾å¤‡è¿›è¡Œæ•…éšœåˆ‡æ¢ã€‚ æ­¤å‚æ•°æ§åˆ¶Redisç¾¤é›†ä¸­çš„å…¶ä»–é‡è¦äº‹é¡¹ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªæ— æ³•åœ¨æŒ‡å®šæ—¶é—´å†…åˆ°è¾¾å¤§å¤šæ•°ä¸»èŠ‚ç‚¹çš„èŠ‚ç‚¹å°†åœæ­¢æ¥å—æŸ¥è¯¢ã€‚

4. **cluster-slave-validity-factor** ï¼šå¦‚æœè®¾ç½®ä¸º0ï¼Œæ— è®ºä¸»è®¾å¤‡å’Œä»è®¾å¤‡ä¹‹é—´çš„é“¾è·¯ä¿æŒæ–­å¼€è¿æ¥çš„æ—¶é—´é•¿çŸ­ï¼Œä»è®¾å¤‡éƒ½å°†å°è¯•æ•…éšœåˆ‡æ¢ä¸»è®¾å¤‡ã€‚ å¦‚æœè¯¥å€¼ä¸ºæ­£å€¼ï¼Œåˆ™è®¡ç®—æœ€å¤§æ–­å¼€æ—¶é—´ä½œä¸ºèŠ‚ç‚¹è¶…æ—¶å€¼ä¹˜ä»¥æ­¤é€‰é¡¹æä¾›çš„ç³»æ•°ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹ï¼Œåˆ™åœ¨ä¸»é“¾è·¯æ–­å¼€è¿æ¥çš„æ—¶é—´è¶…è¿‡æŒ‡å®šçš„è¶…æ—¶å€¼æ—¶ï¼Œå®ƒä¸ä¼šå°è¯•å¯åŠ¨æ•…éšœåˆ‡æ¢ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœèŠ‚ç‚¹è¶…æ—¶è®¾ç½®ä¸º5ç§’ï¼Œå¹¶ä¸”æœ‰æ•ˆå› å­è®¾ç½®ä¸º10ï¼Œåˆ™ä¸ä¸»è®¾å¤‡æ–­å¼€è¿æ¥è¶…è¿‡50ç§’çš„ä»è®¾å¤‡å°†ä¸ä¼šå°è¯•å¯¹å…¶ä¸»è®¾å¤‡è¿›è¡Œæ•…éšœåˆ‡æ¢ã€‚ è¯·æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰ä»æœåŠ¡å™¨èŠ‚ç‚¹èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œåˆ™ä»»ä½•éé›¶å€¼éƒ½å¯èƒ½å¯¼è‡´Redisç¾¤é›†åœ¨ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœåä¸å¯ç”¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰åŸå§‹ä¸»èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤æ—¶ï¼Œé›†ç¾¤æ‰ä¼šè¿”å›å¯ç”¨ã€‚

5. **cluster-migration-barrier**ï¼šä¸»è®¾å¤‡å°†ä¿æŒè¿æ¥çš„æœ€å°ä»è®¾å¤‡æ•°é‡ï¼Œä»¥ä¾¿å¦ä¸€ä¸ªä»è®¾å¤‡è¿ç§»åˆ°ä¸å—ä»»ä½•ä»è®¾å¤‡è¦†ç›–çš„ä¸»è®¾å¤‡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬æ•™ç¨‹ä¸­æœ‰å…³å‰¯æœ¬è¿ç§»çš„ç›¸åº”éƒ¨åˆ†ã€‚

6. **cluster-require-full-coverage**ï¼šå¦‚æœå°†å…¶è®¾ç½®ä¸ºyesï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœkeyçš„ç©ºé—´çš„æŸä¸ªç™¾åˆ†æ¯”æœªè¢«ä»»ä½•èŠ‚ç‚¹è¦†ç›–ï¼Œåˆ™é›†ç¾¤åœæ­¢æ¥å—å†™å…¥ã€‚ å¦‚æœè¯¥é€‰é¡¹è®¾ç½®ä¸ºnoï¼Œåˆ™å³ä½¿åªå¤„ç†å…³äºkeyså­é›†çš„è¯·æ±‚ï¼Œç¾¤é›†ä»å°†æä¾›æŸ¥è¯¢ã€‚

### 1. å­èŠ‚ç‚¹é…ç½®èŒƒä¾‹

```
port 6379                      //èŠ‚ç‚¹ç«¯å£
cluster-enabled yes              //å¼€å¯é›†ç¾¤æ¨¡å¼
cluster-node-timeout 15000       //èŠ‚ç‚¹è¶…æ—¶æ—¶é—´ï¼ˆæ¥æ”¶pongæ¶ˆæ¯å›å¤çš„æ—¶é—´ï¼‰
cluster-config-file  /usr/localbin/cluster/data/nodes-6379.conf é›†ç¾¤å†…éƒ¨é…ç½®æ–‡ä»¶
```

### 2. å¯åŠ¨æœåŠ¡

ç•¥ç•¥ç•¥ç•¥ğŸ˜›

### 3. å„èŠ‚ç‚¹æ¡æ‰‹

ç™»å½•å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶å`meet` æ‰€æœ‰èŠ‚ç‚¹

```
cluster meet  192.168.2.123:6378
...
```

åœ¨æ“ä½œå®Œæ‰€æœ‰èŠ‚ç‚¹ä¹‹åï¼Œå¯ä»¥é€šè¿‡ `cluster nodes` è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯

> é»˜è®¤èŠ‚ç‚¹æ¡æ‰‹ä¹‹åï¼Œæ˜¯ç¦æ­¢è¯»å†™
>
> å¯ä»¥é€šè¿‡ `cluster info ` æŸ¥çœ‹çŠ¶æ€

### 4. åˆ†é…æ§½ 

```
redis-cli -h 192.168.152.128 -p 6379 cluster addslots {0...5461}

redis-cli -h 192.168.152.128 -p 6380 cluster addslots {5641...10922}

redis-cli -h 192.168.152.128 -p 6381 cluster addslots {10923...16383}
```

æŠŠ `0 - 16383` ä¸ªæ§½åˆ†é…ç»™ä¸‰ä¸ªèŠ‚ç‚¹

å†æ¬¡æŸ¥çœ‹ `cluster info`



## é›†ç¾¤è‡ªåŠ¨åˆ†é…æ§½

https://www.cnblogs.com/leeSmall/p/8414687.html



## å‚è€ƒ

- https://www.cnblogs.com/PatrickLiu/p/8458788.html
- https://www.cnblogs.com/leeSmall/p/8414687.html
- https://blog.csdn.net/lupengfei1009/article/details/88323561

